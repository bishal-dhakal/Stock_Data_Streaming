<!DOCTYPE html>
<html>
<head>
    <title>Stock Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .container { 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px;
            font-family: Arial;
        }
        .live-data {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .historical-data {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
        }
        .data-row {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Stock: <span id="symbol">GOOGL</span></h2>
        
        <div class="live-data">
            <h3>Live Data</h3>
            <p>Price: $<span id="live-price">-</span></p>
            <p>Volume: <span id="live-volume">-</span></p>
            <p>Time: <span id="live-time">-</span></p>
        </div>

        <h3>Historical Data</h3>
        <div class="historical-data" id="historical-container"></div>
    </div>

    <script>
        $(document).ready(function() {
            const symbol = 'GOOGL';
            let ws = new WebSocket(`ws://localhost:8001/ws/${symbol}`);

            ws.onopen = function() {
                console.log('Connected to WebSocket');
            };

            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                if (data.type === 'historical') {
                    displayHistoricalData(data.data);
                } else {
                    updateLiveData(data.data);
                }
            };

            function updateLiveData(data) {
                $('#live-price').text(data.price);
                $('#live-volume').text(data.volume);
                $('#live-time').text(data.created_at);
                
                // Add to historical at the top
                addHistoricalRow(data);
            }

            function displayHistoricalData(data) {
                $('#historical-container').empty();
                data.forEach(addHistoricalRow);
            }

            function addHistoricalRow(data) {
                const row = $('<div class="data-row">')
                    .html(`Price: $${data.price} | Volume: ${data.volume} | Time: ${data.created_at}`);
                $('#historical-container').prepend(row);
            }

            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
            };

            // Clean up on page unload
            $(window).on('unload', function() {
                ws.close();
            });
        });
    </script>
</body>
</html>